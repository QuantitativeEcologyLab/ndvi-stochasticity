---
title: "DENVar: A global Dynamic Estimate of NDVI Variance"
author:
  - name: Stefano Mezzini
    institute: [braes, biol]
  - name: Michael J. Noonan
    email: michael.noonan@ubc.ca
    institute: [braes, biol, cmps]
    correspondence: "yes"
institute:
  - braes: Okanagan Institute for Biodiversity, Resilience, and Ecosystem Services, The University of British Columbia Okanagan, Kelowna, British Columbia, Canada.
  - biol: Department of Biology, The University of British Columbia Okanagan, Kelowna, British Columbia, Canada.
  - cmps: Department of Computer Science, Math, Physics, and Statistics, The University of British Columbia Okanagan, Kelowna, British Columbia, Canada.
bibliography: 'ndvi-stochasticity.bib'
csl: 'freshwater-biology.csl'
fontsize: 12pt
indent: true
header-includes:
    - \usepackage{setspace}\doublespacing # for double-spaced text
    - \usepackage{indentfirst} # for indenting first line of each paragraph
    - \usepackage[small]{titlesec} # for smaller font for headings
    - \usepackage{caption} # for more customization of captions
    - \captionsetup[figure]{font={scriptsize, doublespacing}, labelfont=bf, aboveskip=4pt, belowskip=-15pt}
    - \usepackage{hanging} # for hanging indents in references
    - \usepackage[left]{lineno} # for line numbers
subparagraph: true # needed for \usepackage[small]{titlesec}
output:
  bookdown::pdf_document2:
    pandoc_args:
# https://github.com/pandoc/lua-filters/blob/master/author-info-blocks/README.md
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
    toc: false
    number_sections: false
    keep_tex: false # for submitting TeX file
editor_options:
  chunk_output_type: console
---

```{r, echo=FALSE}
# need to write abstract before cover page to state number of words in it
abstract <- "Since the 1980s, remote-sensing estimates of habitat productivity such as the Normalized Differnece Vegetation Index (NDVI) have helped develop and support a variety of hypotheses and inform policy and industriy-related decisions. The free availability of such data has allowed widespread access and use of well-established metrics of habitat productivity. However, historically, users tended to focus solely on (predictable) trends in productivity. In recent years, people have been recognizing the importance of envrironmental unpredictability (stochasticity), particularly as climate change and human-induced rapid environmental change transform the ecosystems species have evolved in and adapted to. We adress this gap by presenting a new global Dynamic Estimate of NDVI Variance, *DENVar*. We estimate spatiotemporal trends in mean NDVI and the variance around the mean using Hierarchical Generalized Additive Models, which provide a flexible yet transparent model structure, unlike machine learning approaches such as neural netwoks. We show that DENVar can be used as a reliable proxy of environmental stochasticity, strongly correlates with ***XXX***, and can be used to test many hepotheses related to environmental stochasitcity, such as forage unpredictability, regime shifts, ... . We conclude by offering some considerations around quantifying and interpreting envirnomental stochasticity, and we provide a publicly and freely available shiny app for estimating mean NDVI and the variance around it, DENVar, for given coordinates and optional dates. The app requires no knowledge of statistics or coding. Additionally, we provide a temporally static raster of mean NDVI and DENVar for the years 1981-2025 that can be used for GIS applications and does not require any knowledge of $\\texttt{R}$."

if(FALSE) {
  stringi::stri_count_words(abstract)
}
```

<!-- elements of the title page -->

\clearpage

\noindent \textbf{Article type}: Research article

\noindent \textbf{Words in abstract}: `r stringi::stri_count_words(abstract)`

\noindent \textbf{Words in main text}: `r suppressMessages(wordcountaddin::word_count())`

\noindent \textbf{Figures}: \textcolor{red}{\textbf{XXX}}

\noindent \textbf{Tables}: \textcolor{red}{\textbf{XXX}}

\noindent \textbf{References}: \textcolor{red}{\textbf{XXX}}

\noindent \textbf{Appendices}: \textcolor{red}{\textbf{XXX}}

\noindent \textbf{Key words:} remote sensing, NDVI, environmental stochasticity, \textcolor{red}{\textbf{XXX}}

<!-- start main body on a new page -->

\newpage

\doublespacing

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = '100%', fig.align = 'center')
```

\linenumbers

# Abstract

\noindent `r abstract`

\newpage

# Introduction

<!-- remote sensing allows us to study landscapes in detail and over large spatiotemporal scales -->

\noindent Developments in remote sensing since the 1970s have greatly expanded our ability to quantify and monitor lanscapes using satellite imagery

- NDVI is an estimate of greenness, NPP, forage availability
  - NDVI has many uses and is often convenient because it's free, well-established, and 

<!-- successes of NDVI: pettorelli, Aikens -->

many people focus on changes in the mean

<!-- what counts as a change? predictable vs stochastic changes -->

ability to predict and respond to changes in mean conditions (forage availability, phenology, etc.) depends on the scale of changes relative to the perception scale [@levin_problem_1992; @frankham_importance_2004; @riotte-lambert_environmental_2020; @steixner-kumar_strategies_2020] and memory [@abrahms_memory_2019]. Consequently, environmental stochasticity is also an important driver, besides changes in the mean [@mezzini_how_2025]

<!-- difficulties in estimating variance -->

* variance is hard to calculate, as it depends on a correct estimate of the mean
* paper on estimating the asymptote of environmental variance globally, but variance for a closed system must converge towards a finite value [@bachmaier_variogram_2011; @fleming_fine-scale_2014]

<!-- we present a new measure that is estimated in an understandable way -->

* we present DENVar
* HGAMs are higly flexible models that allow us to estimate trends in the data without imposing preconceived expectations
* more transparent than black-box machine learning methods like neural networks, etc.
* https://www.sciencedirect.com/science/article/abs/pii/S0034425718305625
* https://silvis.forest.wisc.edu/data/dhis/

# Methods

## Choice of color schemes

We represent NDVI using a modified version of Fabio Crameri's divergent *bukavu* palette [@crameri_geodynamic_2018], which has high-contrast for deuteranope and protanope vision. For NDVI values between 0 and 1 (the right half of the palette), the colors also have sufficient contrast for the colors to be distinguishable by both tritanope and achomatic vision. Appendix A contains an approximate representation of the color palette for each vision type. We obtained all color palettes from the `khroma` package [v. 1.14.0, @frerebeau_khroma_2024] for `R` [v. 4.4.1, @r_core_team_r_2024].

## Input data

The models we fit 

### NDVI data

* daily AVHRR-VIIRS
* 15-day average and `aggregate(, 2)` to make dataset small enough to fit in a single data frame

```{r, eval=FALSE}
# approximate estimate of the number of unique DOY values
length(unique(seq(1, 365.25 * (2025 - 1981), by = 15) %% c(365, 365, 365, 366)))
```

### Predictor data

Maps are in Appendix A.

## Modeling

We estimated spatiotemporal trends in mean NDVI using Hierarchical Generalized Additive Models (HGAMs) via the `mgcv` package for `R` [v. 1.9-3, @wood_generalized_2017]. To reduce modeling fitting times with negligible losses to model accuracy, we used the `bam()` function with fast REstricted Marginal Likelihood (`method = fREML`) and covariate discretization (`discrete = TRUE`). The model structure is available below.

```{r, eval=FALSE}
# the model for the mean
```


# Results

output of `draw()`

hex plots of mean and var vs common metrics:
* temperature
* seasonal temperature range
* precip
* seasonal temperature range
* spp diversity
* gross primary productivity
* hfi
* max animal weight
* https://silvis.forest.wisc.edu/globalwui/
* https://silvis.forest.wisc.edu/data/dhis/:
  * NDVI16 (Normalized Difference Vegetation Index)
  * EVI16 (Enhanced Vegetation Index)
  * FPAR8 (Fraction absorbed Photosynthetically Active Radiation)
  * LAI8 (Leaf Area Index)
  * GPP8 (Gross Primary Productivity)
* https://silvis.forest.wisc.edu/data/eurasia-trends/

# Discussion

* green wave surfing
* migration routes are key habitat (Ortega et al., in prep), especially in stochastic environments
* @sawyer_migratory_2019
* https://www.sciencedirect.com/science/article/pii/S0960982220308484
* https://onlinelibrary.wiley.com/doi/full/10.1111/gcb.15169
* industrial development affects animals' ability to respond to both predictable and unpredictable change (https://www.nature.com/articles/s41559-022-01887-9)
* effects of sudden deep snow in red desert on proghorn (https://www.sciencedirect.com/science/article/abs/pii/S0960982225002957)
* https://www.nature.com/articles/s41467-023-37750-z
* https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.4238
* see data for snow and pronghorn paper (Aikens et al. 2025)
* detecting regime shifts [in lakes: @bjorndahl_abrupt_2022]

* smoothness of mu impacts smoothness and size of s2: depends on animals' ability to respond to, learn, and predict E(R)

## Why not use machine learning? / Advantages of not using ML

arguably, GAMs can be considered as a form of ML, but we are referring to NNs and other forms of black-box ML.

\clearpage

# Useful references

* `{khroma}`: @frerebeau_khroma_2024
* @keith_predicting_2008
* @chevin_adaptation_2010
* @rickbeil_plasticity_2019
* @mueller_search_2008
* @pettorelli_using_2005
* @keys_machine-learning_2021
* @nilsen_can_2005
* @stephens_optimal_1982
* @merkle_large_2016
* @tian_evaluating_2015
* @huang_commentary_2021
* @fan_global_2016
* @wang_stochastic_2019
* @pease_ecological_2024
* @xu_plasticity_2021
* @mezzini_how_2025

\clearpage

# References
